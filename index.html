<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로컬링크 파트너 - 데이터 보상 시스템</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;900&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; margin: 0; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .break-keep { word-break: keep-all; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot, doc, getDoc, setDoc, updateDoc, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        window.FirebaseSDK = {
            initializeApp, getAuth, signInAnonymously, onAuthStateChanged,
            getFirestore, collection, addDoc, serverTimestamp, onSnapshot, doc, getDoc, setDoc, updateDoc, query
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const Icon = ({ name, size = 24, className = "" }) => {
            const icons = {
                "loader": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="spinner"><path d="M21 12a9 9 0 1 1-6.219-8.56" /></svg>,
                "database": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>,
                "target": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
                "gem": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 3h12l4 6-10 12L2 9Z"/><path d="M11 3 8 9l4 12 4-12-3-6"/><path d="M2 9h20"/></svg>,
                "chevron-right": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
                "arrow-left": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
                "check": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 6 9 17l-5-5"/></svg>,
                "send": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>,
                "shield": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></svg>,
                "download": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
                "settings": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
                "save": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
                "clipboard-check": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="m9 14 2 2 4-4"/></svg>,
                "user": <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            };
            return <span className={`inline-block ${className}`} style={{ width: size, height: size }}>{icons[name] || null}</span>;
        };

        const THEMES = {
            general: { primary: "indigo", bg: "bg-indigo-600", text: "text-indigo-600", border: "border-indigo-600", light: "bg-indigo-50", isMedical: false },
            medical: { primary: "emerald", bg: "bg-emerald-600", text: "text-emerald-600", border: "border-emerald-600", light: "bg-emerald-50", isMedical: true }
        };

        const firebaseConfig = {
            apiKey: "AIzaSyBAngyJvkAQ5lbRNH3I5PI4TtPH1CFY7fA",
            authDomain: "link-final-a7d96.firebaseapp.com",
            projectId: "link-final-a7d96",
            storageBucket: "link-final-a7d96.firebasestorage.app",
            messagingSenderId: "764608459792",
            appId: "1:764608459792:web:2bf90ae95419c5d32c4695",
            measurementId: "G-TDS9MCRX70"
        };

        function App() {
            const [view, setView] = useState('survey'); 
            const [step, setStep] = useState(0);
            const [tier, setTier] = useState(null);
            const [user, setUser] = useState(null);
            const [isAdminAuth, setIsAdminAuth] = useState(false);
            const [pw, setPw] = useState("");
            const [isLoading, setIsLoading] = useState(true);
            const [leads, setLeads] = useState([]);
            const [activeTab, setActiveTab] = useState("list");
            
            // 초기 설정값
            const [config, setConfig] = useState({
                merchantId: "default", merchantName: "로컬링크 파트너", themeType: "general", marketerName: "본사",
                marketerRecipient: "", // 리워드 수령인 정보 추가
                stdPrice: 120000, prePrice: 200000, stdReward: 25000, preReward: 49000,
                stdOptions: "사회 초년생, 신혼부부, 자녀양육, 은퇴준비",
                preOptions: "법인 대표, 개인사업자, 전문직, 자산가",
                stdQuestions: "월 고정 금융 비용 최적화 지표평가|생애 주기별 유동성 확보 데이터 평가|리스크 비용 & 비상 상황 대비 자산 완충 지수 평가",
                preQuestions: "사업 구조 전환에 따른 자산 가치 데이터 평가|미정산 재무 계정의 리스크 인덱스 및 정산 효율성 평가|사내 유보 자본의 유동화 및 자본 구조 최적화 지표 평가|기업 승계 데이터 유효성 검증 및 세대 간 자산 이동 효율성 평가"
            });

            const [formData, setFormData] = useState({ name: "", birth: "", phone: "", region: "", category: "", interest: "" });
            const [agreed, setAgreed] = useState({ collect: false, contract: false });

            const appId = typeof __app_id !== 'undefined' ? __app_id : 'locallink-final-v2';
            const theme = THEMES[config.themeType] || THEMES.general;

            useEffect(() => {
                const init = async () => {
                    if (!window.FirebaseSDK) return setTimeout(init, 100);
                    const { initializeApp, getAuth, signInAnonymously, onAuthStateChanged, getFirestore, doc, getDoc } = window.FirebaseSDK;
                    const app = initializeApp(firebaseConfig);
                    const auth = getAuth(app);
                    const db = getFirestore(app);
                    window.db = db;

                    await signInAnonymously(auth);
                    
                    const params = new URLSearchParams(window.location.search);
                    const mid = params.get('id');
                    if (mid) {
                        const snap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'merchants', mid));
                        if (snap.exists()) setConfig(prev => ({ ...prev, ...snap.data() }));
                    }
                    setIsLoading(false);
                    onAuthStateChanged(auth, setUser);
                };
                init();
            }, []);

            useEffect(() => {
                if (view === 'admin' && isAdminAuth && user) {
                    const { collection, onSnapshot } = window.FirebaseSDK;
                    const q = collection(window.db, 'artifacts', appId, 'public', 'data', 'leads');
                    const unsubscribe = onSnapshot(q, (snapshot) => {
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setLeads(data.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0)));
                    });
                    return () => unsubscribe();
                }
            }, [view, isAdminAuth, user]);

            const handleStatusUpdate = async (leadId, field, value) => {
                const { doc, updateDoc } = window.FirebaseSDK;
                await updateDoc(doc(window.db, 'artifacts', appId, 'public', 'data', 'leads', leadId), { [field]: value });
            };

            const handleSubmit = async () => {
                if (!agreed.collect || !agreed.contract) return alert("필수 동의 항목에 체크해주세요.");
                setIsLoading(true);
                const { collection, addDoc, serverTimestamp } = window.FirebaseSDK;
                try {
                    const sellingPrice = tier === 'premium' ? config.prePrice : config.stdPrice;
                    const customerReward = tier === 'premium' ? config.preReward : config.stdReward;
                    
                    await addDoc(collection(window.db, 'artifacts', appId, 'public', 'data', 'leads'), {
                        ...formData, 
                        merchantId: config.merchantId, 
                        merchantName: config.merchantName,
                        marketerName: config.marketerName, 
                        marketerRecipient: config.marketerRecipient || "정보 없음", // 신청 시점의 수령인 정보 기록
                        tier,
                        sellingPrice,
                        customerReward,
                        isConsulted: false,
                        isFake: false,
                        isRewardPaid: false,
                        createdAt: serverTimestamp()
                    });
                    setStep(3);
                } catch (e) { alert("오류 발생"); }
                setIsLoading(false);
            };

            const getCalculatedReward = (lead) => {
                if (lead.isFake) return { owner: 0, platform: 0, marketer: 0 };
                const base = lead.sellingPrice - lead.customerReward;
                return {
                    owner: Math.floor(base * 0.35),
                    platform: Math.floor(base * 0.50),
                    marketer: Math.floor(base * 0.15)
                };
            };

            if (isLoading && step !== 3) return (
                <div className="min-h-screen bg-white flex flex-col items-center justify-center space-y-4">
                    <Icon name="loader" className={theme.text} size={40} />
                    <p className="text-[10px] font-black tracking-widest text-slate-400 uppercase">System Initializing...</p>
                </div>
            );

            return (
                <div className="min-h-screen flex flex-col items-center overflow-x-hidden">
                    {view === 'survey' ? (
                        <div className="w-full max-w-md bg-white min-h-screen flex flex-col relative shadow-2xl">
                            {step === 0 && (
                                <div className="flex-1 animate-fade-in">
                                    <div className="p-8 pt-12 bg-slate-50 border-b border-slate-100 rounded-b-[2.5rem]">
                                        <div className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full ${theme.light} ${theme.text} text-[10px] font-black uppercase tracking-widest mb-4`}>
                                            <Icon name="database" size={12} /> Data Reward System
                                        </div>
                                        <h1 className="text-[1.8rem] font-black leading-[1.2] mb-4 break-keep">우리 {config.themeType === 'medical' ? '원장님' : '사장님'}이 직접 드리는 데이터 보상</h1>
                                        <p className="text-slate-500 text-[14px] leading-relaxed break-keep opacity-90 mb-4">내방 고객을 위한 데이터 보상 혜택 시스템! 고객님의 라이프 지표를 데이터로 공급하고 리워드 포인트를 받으세요.</p>
                                        <div className="grid grid-cols-2 gap-3 mt-6">
                                            <div className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 text-center">
                                                <p className="text-[9px] font-black text-slate-400 uppercase mb-1">참여율</p>
                                                <p className="text-xl font-black">96.8%</p>
                                            </div>
                                            <div className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 text-center">
                                                <p className="text-[9px] font-black text-slate-400 uppercase mb-1">최대 보상</p>
                                                <p className={`text-xl font-black ${theme.text}`}>4.9만 포인트</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="p-6 space-y-4">
                                        <button onClick={() => { setTier('standard'); setStep(1); }} className="w-full p-6 bg-white border-2 border-slate-100 rounded-3xl text-left transition-all active:scale-95 hover:border-indigo-500 shadow-sm">
                                            <div className="flex justify-between items-start mb-4">
                                                <div className="p-3 bg-indigo-50 text-indigo-600 rounded-xl"><Icon name="target" size={24}/></div>
                                                <span className="text-[10px] font-black text-slate-300 uppercase">Lifestyle Index</span>
                                            </div>
                                            <h3 className="text-lg font-black mb-1">가계 경제 지표 가치 회복</h3>
                                            <div className="flex justify-between items-end">
                                                <span className="text-xl font-black text-indigo-600">2.5만 포인트</span>
                                                <Icon name="chevron-right" className="text-slate-200" />
                                            </div>
                                        </button>
                                        <button onClick={() => { setTier('premium'); setStep(1); }} className="w-full p-6 bg-slate-900 text-white rounded-3xl text-left transition-all active:scale-95 shadow-xl">
                                            <div className="flex justify-between items-start mb-4">
                                                <div className={`p-3 ${theme.bg} text-white rounded-xl shadow-lg`}><Icon name="gem" size={24}/></div>
                                                <span className="text-[10px] font-black text-white/30 uppercase">Premium Strategy</span>
                                            </div>
                                            <h3 className="text-lg font-black mb-1">기업 경영 전략 인덱스 보상</h3>
                                            <div className="flex justify-between items-end">
                                                <span className={`text-xl font-black text-teal-400`}>4.9만 포인트</span>
                                                <Icon name="chevron-right" className="text-white/20" />
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            )}

                            {step === 1 && (
                                <div className="flex-1 p-8 animate-fade-in">
                                    <button onClick={() => setStep(0)} className="mb-6 text-slate-400 flex items-center gap-1 font-bold text-xs"><Icon name="arrow-left" size={14}/> 이전으로</button>
                                    <h2 className="text-2xl font-black text-slate-900 mb-2 italic">Data Indexing</h2>
                                    <div className="grid grid-cols-2 gap-3 mb-8">
                                        {(tier === 'standard' ? config.stdOptions.split(',') : config.preOptions.split(',')).map(c => (
                                            <button key={c} onClick={() => setFormData({...formData, category: c.trim()})} className={`py-4 rounded-xl border-2 text-[12px] font-black transition-all ${formData.category === c.trim() ? `${theme.border} ${theme.light} ${theme.text}` : 'bg-slate-50 text-slate-400 border-transparent'}`}>{c.trim()}</button>
                                        ))}
                                    </div>
                                    <div className="space-y-3">
                                        <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-2 italic">Evaluation Target</p>
                                        {(tier === 'standard' ? config.stdQuestions.split('|') : config.preQuestions.split('|')).map(q => (
                                            <button key={q} onClick={() => setFormData({...formData, interest: q.trim()})} className={`w-full p-5 rounded-xl border-2 text-left text-[12px] font-bold transition-all break-keep ${formData.interest === q.trim() ? `${theme.border} ${theme.light} ${theme.text}` : 'bg-slate-50 text-slate-400 border-transparent'}`}>{q.trim()}</button>
                                        ))}
                                    </div>
                                    <button disabled={!formData.category || !formData.interest} onClick={() => setStep(2)} className={`mt-10 w-full ${theme.bg} text-white py-5 rounded-2xl font-black shadow-xl disabled:opacity-30`}>다음 단계로</button>
                                </div>
                            )}

                            {step === 2 && (
                                <div className="flex-1 p-8 animate-fade-in overflow-y-auto">
                                    <button onClick={() => setStep(1)} className="mb-6 text-slate-400 flex items-center gap-1 font-bold text-xs"><Icon name="arrow-left" size={14}/> 이전으로</button>
                                    <h2 className="text-2xl font-black text-slate-900 mb-2 italic">Contract</h2>
                                    <div className="space-y-4 mb-8">
                                        <input type="text" placeholder="성함" className="w-full p-4 bg-slate-50 rounded-xl font-bold outline-none border-2 border-transparent focus:border-indigo-500" onChange={e => setFormData({...formData, name: e.target.value})} />
                                        <div className="grid grid-cols-2 gap-3">
                                            <input type="text" placeholder="생년월일 (6자리)" className="w-full p-4 bg-slate-50 rounded-xl font-bold outline-none border-2 border-transparent focus:border-indigo-500" onChange={e => setFormData({...formData, birth: e.target.value})} />
                                            <input type="tel" placeholder="연락처 (-제외)" className="w-full p-4 bg-slate-50 rounded-xl font-bold outline-none border-2 border-transparent focus:border-indigo-500" onChange={e => setFormData({...formData, phone: e.target.value})} />
                                        </div>
                                        <input type="text" placeholder="거주 지역 (시/군/구)" className="w-full p-4 bg-slate-50 rounded-xl font-bold outline-none border-2 border-transparent focus:border-indigo-500" onChange={e => setFormData({...formData, region: e.target.value})} />
                                    </div>
                                    
                                    <div className="space-y-3 mb-10">
                                        <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100">
                                            <div className="flex items-center gap-3 mb-3 cursor-pointer" onClick={() => setAgreed({...agreed, collect: !agreed.collect})}>
                                                <div className={`w-5 h-5 rounded flex items-center justify-center border-2 ${agreed.collect ? 'bg-indigo-600 border-indigo-600' : 'bg-white border-slate-200'}`}>{agreed.collect && <Icon name="check" size={14} className="text-white"/>}</div>
                                                <span className="text-[11px] font-black text-slate-700 uppercase">[필수] 개인정보 수집 및 이용 동의</span>
                                            </div>
                                            <div className="text-[10px] text-slate-400 font-medium leading-relaxed bg-white p-3 rounded-lg border border-slate-100">
                                                • 수집 항목: 성명, 생년월일, 연락처, 주소, 설문 데이터<br/>
                                                • 수집 목적: 데이터 가치 산정 및 보상 지급 자격 확인, 전문가 매칭 안내<br/>
                                                • 보유 기간: 보상 지급 완료 후 1년 또는 정보 주체의 파기 요청 시까지
                                            </div>
                                        </div>
                                        <div className="bg-slate-900 p-5 rounded-2xl shadow-lg cursor-pointer" onClick={() => setAgreed({...agreed, contract: !agreed.contract})}>
                                            <div className="flex items-start gap-4 mb-4">
                                                <div className={`mt-0.5 w-5 h-5 rounded flex items-center justify-center border-2 ${agreed.contract ? 'bg-emerald-500 border-emerald-500' : 'bg-white/10 border-white/20'}`}>{agreed.contract && <Icon name="check" size={14} className="text-white"/>}</div>
                                                <span className="text-[11px] font-black text-slate-100 uppercase italic">[필수] 데이터 매매 계약 및 검증 동의</span>
                                            </div>
                                            <ul className="text-[9px] text-slate-500 space-y-1.5 border-t border-white/10 pt-3 font-bold italic">
                                                <li>• 보상 조건: 배정된 분석 전문가와의 대면 상담을 통한 데이터 실검증 완료 시 확정 지급</li>
                                                <li>• 고지 사항: 본 프로그램은 금융상품 가입을 강제하지 않으며 정당한 데이터 거래 계약을 기반으로 합니다.</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <button onClick={handleSubmit} className={`w-full ${theme.bg} text-white py-5 rounded-2xl font-black text-lg shadow-xl uppercase tracking-widest`}>신청 완료</button>
                                </div>
                            )}

                            {step === 3 && (
                                <div className="flex-1 flex flex-col items-center justify-center p-8 text-center animate-fade-in">
                                    <div className={`w-24 h-24 ${theme.light} ${theme.text} rounded-full flex items-center justify-center mb-10 shadow-inner`}><Icon name="clipboard-check" size={48} /></div>
                                    <h2 className="text-3xl font-black mb-6 italic uppercase tracking-tighter">Application Sent</h2>
                                    <p className="text-slate-600 font-bold mb-10 break-keep">분석 전문가와의 대면 검증 후 플랫폼에서 약속된 보상을 전달해 드립니다.</p>
                                    <button onClick={() => window.location.reload()} className="w-full bg-slate-900 text-white p-5 rounded-2xl font-black uppercase shadow-xl">확인</button>
                                </div>
                            )}
                            <button onClick={() => setView('admin')} className="absolute bottom-0 left-0 w-full h-8 opacity-0 cursor-default">Admin</button>
                        </div>
                    ) : (
                        // --- [관리자 모드] ---
                        <div className="w-full max-w-7xl bg-slate-50 min-h-screen p-6 flex flex-col items-center">
                            {isAdminAuth ? (
                                <div className="w-full animate-fade-in">
                                    <header className="flex justify-between items-center mb-8 w-full">
                                        <h1 className="text-2xl font-black italic underline decoration-indigo-500 decoration-[6px]">Control Center</h1>
                                        <div className="flex gap-2">
                                            <button onClick={() => setActiveTab("list")} className={`px-4 py-2 rounded-full text-[10px] font-black ${activeTab === 'list' ? 'bg-slate-900 text-white' : 'bg-white text-slate-400'}`}>Leads</button>
                                            <button onClick={() => setActiveTab("settings")} className={`px-4 py-2 rounded-full text-[10px] font-black ${activeTab === 'settings' ? 'bg-slate-900 text-white' : 'bg-white text-slate-400'}`}>Config</button>
                                            <button onClick={() => { setIsAdminAuth(false); setView('survey'); }} className="px-4 py-2 bg-rose-50 text-rose-500 rounded-full text-[10px] font-black uppercase tracking-widest">Logout</button>
                                        </div>
                                    </header>

                                    {activeTab === 'list' ? (
                                        <div className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100 w-full">
                                            <div className="overflow-x-auto">
                                                <table className="w-full text-left text-[11px] font-bold">
                                                    <thead className="bg-slate-900 text-white text-[9px] font-black uppercase italic">
                                                        <tr>
                                                            <th className="p-4">고객/연락처</th>
                                                            <th className="p-4">등급/지역</th>
                                                            <th className="p-4">상담/허위</th>
                                                            <th className="p-4">매장/영업자</th>
                                                            <th className="p-4">리워드 정산 (35:50:15)</th>
                                                            <th className="p-4">지급상태</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {leads.map(l => {
                                                            const rewards = getCalculatedReward(l);
                                                            return (
                                                                <tr key={l.id} className={`border-b border-slate-50 ${l.isFake ? 'bg-rose-50 opacity-60' : ''}`}>
                                                                    <td className="p-4">{l.name}<br/><span className="text-slate-400">{l.phone}</span></td>
                                                                    <td className="p-4 uppercase">{l.tier}<br/><span className="text-slate-400">{l.region}</span></td>
                                                                    <td className="p-4 space-y-1">
                                                                        <label className="flex items-center gap-1 cursor-pointer">
                                                                            <input type="checkbox" checked={l.isConsulted} onChange={(e) => handleStatusUpdate(l.id, 'isConsulted', e.target.checked)} />
                                                                            상담완료
                                                                        </label>
                                                                        <label className="flex items-center gap-1 cursor-pointer text-rose-500">
                                                                            <input type="checkbox" checked={l.isFake} onChange={(e) => handleStatusUpdate(l.id, 'isFake', e.target.checked)} />
                                                                            허위정보
                                                                        </label>
                                                                    </td>
                                                                    <td className="p-4">{l.merchantName}<br/><span className="text-slate-400">{l.marketerName}</span></td>
                                                                    <td className="p-4">
                                                                        <div className="flex flex-col gap-0.5">
                                                                            <span className="text-indigo-600">매장주(35%): {rewards.owner.toLocaleString()}원</span>
                                                                            <span className="text-slate-500">플랫폼(50%): {rewards.platform.toLocaleString()}원</span>
                                                                            <div className="flex flex-col border-l-2 border-emerald-500 pl-2 mt-1">
                                                                                <span className="text-emerald-600 font-black">영업자(15%): {rewards.marketer.toLocaleString()}원</span>
                                                                                <span className="text-[9px] text-slate-400 italic">수령: {l.marketerRecipient || "정보 없음"}</span>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                    <td className="p-4">
                                                                        <button 
                                                                            onClick={() => handleStatusUpdate(l.id, 'isRewardPaid', !l.isRewardPaid)}
                                                                            className={`px-3 py-1.5 rounded-lg text-[9px] font-black uppercase ${l.isRewardPaid ? 'bg-emerald-500 text-white' : 'bg-slate-100 text-slate-400'}`}
                                                                        >
                                                                            {l.isRewardPaid ? '지급완료' : '지급대기'}
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                            );
                                                        })}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 w-full">
                                            <div className="bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
                                                <h3 className="font-black mb-6 italic flex items-center gap-2 uppercase tracking-tighter">Merchant Info</h3>
                                                <div className="space-y-4">
                                                    <div>
                                                        <label className="text-[9px] font-black text-slate-400 ml-1">매장명</label>
                                                        <input placeholder="매장명" className="w-full p-4 bg-slate-50 rounded-xl font-bold" value={config.merchantName} onChange={e => setConfig({...config, merchantName: e.target.value})} />
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-3">
                                                        <div>
                                                            <label className="text-[9px] font-black text-slate-400 ml-1">영업자명</label>
                                                            <input placeholder="영업자명" className="w-full p-4 bg-slate-50 rounded-xl font-bold" value={config.marketerName} onChange={e => setConfig({...config, marketerName: e.target.value})} />
                                                        </div>
                                                        <div>
                                                            <label className="text-[9px] font-black text-emerald-600 ml-1">영업 리워드 수령인/계좌</label>
                                                            <input placeholder="성함 또는 계좌번호" className="w-full p-4 bg-emerald-50 rounded-xl font-bold border border-emerald-100" value={config.marketerRecipient} onChange={e => setConfig({...config, marketerRecipient: e.target.value})} />
                                                        </div>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button onClick={() => setConfig({...config, themeType: 'general'})} className={`flex-1 p-3 rounded-xl font-black text-[10px] ${config.themeType === 'general' ? 'bg-indigo-600 text-white shadow-md' : 'bg-slate-100 text-slate-400'}`}>일반형 (사장님)</button>
                                                        <button onClick={() => setConfig({...config, themeType: 'medical'})} className={`flex-1 p-3 rounded-xl font-black text-[10px] ${config.themeType === 'medical' ? 'bg-emerald-600 text-white shadow-md' : 'bg-slate-100 text-slate-400'}`}>의료형 (원장님)</button>
                                                    </div>
                                                </div>
                                                <h3 className="font-black mt-10 mb-6 italic flex items-center gap-2 uppercase tracking-tighter">Pricing Config</h3>
                                                <div className="space-y-4">
                                                    <div className="flex items-center gap-2">
                                                        <label className="text-[10px] w-24 font-black">Standard 판매가</label>
                                                        <input type="number" className="flex-1 p-3 bg-slate-50 rounded-xl font-bold" value={config.stdPrice} onChange={e => setConfig({...config, stdPrice: Number(e.target.value)})} />
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <label className="text-[10px] w-24 font-black">Premium 판매가</label>
                                                        <input type="number" className="flex-1 p-3 bg-slate-50 rounded-xl font-bold" value={config.prePrice} onChange={e => setConfig({...config, prePrice: Number(e.target.value)})} />
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div className="bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
                                                <h3 className="font-black mb-6 italic flex items-center gap-2 uppercase tracking-tighter">Category Settings</h3>
                                                <div className="space-y-4">
                                                    <div>
                                                        <label className="text-[10px] font-black ml-1">스탠다드 대상 (콤마구분)</label>
                                                        <input className="w-full p-4 bg-slate-50 rounded-xl font-bold mt-1" value={config.stdOptions} onChange={e => setConfig({...config, stdOptions: e.target.value})} />
                                                    </div>
                                                    <div>
                                                        <label className="text-[10px] font-black ml-1">프리미엄 대상 (콤마구분)</label>
                                                        <input className="w-full p-4 bg-slate-50 rounded-xl font-bold mt-1" value={config.preOptions} onChange={e => setConfig({...config, preOptions: e.target.value})} />
                                                    </div>
                                                    <div>
                                                        <label className="text-[10px] font-black ml-1">스탠다드 설문항목 (| 구분)</label>
                                                        <textarea className="w-full p-4 bg-slate-50 rounded-xl font-bold mt-1 h-24" value={config.stdQuestions} onChange={e => setConfig({...config, stdQuestions: e.target.value})} />
                                                    </div>
                                                    <div>
                                                        <label className="text-[10px] font-black ml-1">프리미엄 설문항목 (| 구분)</label>
                                                        <textarea className="w-full p-4 bg-slate-50 rounded-xl font-bold mt-1 h-24" value={config.preQuestions} onChange={e => setConfig({...config, preQuestions: e.target.value})} />
                                                    </div>
                                                </div>
                                                <button 
                                                    onClick={async () => {
                                                        const { doc, setDoc } = window.FirebaseSDK;
                                                        await setDoc(doc(window.db, 'artifacts', appId, 'public', 'data', 'merchants', config.merchantId), config);
                                                        alert("설정이 저장되었습니다.");
                                                    }}
                                                    className="w-full mt-6 bg-slate-900 text-white py-4 rounded-xl font-black text-xs uppercase shadow-xl hover:bg-black transition-all"
                                                >Save All Settings</button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ) : (
                                <div className="flex-1 flex flex-col items-center justify-center mt-20">
                                    <div className="w-full max-sm bg-white p-12 rounded-[3.5rem] shadow-2xl text-center border border-slate-50">
                                        <h2 className="text-2xl font-black uppercase italic mb-8 tracking-tighter">Security Auth</h2>
                                        <input type="password" placeholder="Access Code" className="w-full p-5 bg-slate-50 rounded-2xl font-black text-center outline-none border-2 border-transparent focus:border-indigo-500 mb-6" value={pw} onChange={e => setPw(e.target.value)} />
                                        <button onClick={() => pw === "1234" ? setIsAdminAuth(true) : alert("비밀번호 불일치")} className="w-full bg-slate-900 text-white py-5 rounded-2xl font-black text-xs uppercase tracking-widest shadow-xl transition-all">Login</button>
                                        <button onClick={() => setView('survey')} className="mt-4 text-slate-300 text-[10px] font-black uppercase tracking-widest">Back to Survey</button>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
